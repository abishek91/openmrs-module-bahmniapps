<article class="consultation">
    
    <section class="block diagnosis">
        <h2>Diagnosis</h2>
        <div class="block-content" ng-show="consultation.newlyAddedDiagnoses.length > 0">
            <h4 class="section">Newly added</h4>
            <div class="diagnosis-row" ng-repeat="diagnosis in consultation.newlyAddedDiagnoses | primaryDiagnosisFirst">
                <h4 class="diagnosis-name" ng-class="{'ruled-out': diagnosis.diagnosisStatus}">{{diagnosis.getDisplayName()}}</h4>
                <div class="secondary">
                    <div class="state">
                        <span ng-show="diagnosis.isPrimary()" class="order">Primary</span>
                        <span ng-hide="diagnosis.isPrimary()" class="order">Secondary</span>
                        <span class="certainty">{{diagnosis.certainty}}</span>
                    </div>

                </div>
            </div>
        </div>
        
        <div class="block-content" ng-show="consultation.savedDiagnosesFromCurrentEncounter.length > 0">
            <h4 class="section">Current</h4>
            <div class="diagnosis-row" ng-repeat="diagnosis in consultation.savedDiagnosesFromCurrentEncounter | primaryDiagnosisFirst">
                <h4 class="diagnosis-name" ng-class="{'ruled-out': diagnosis.diagnosisStatus}">{{diagnosis.getDisplayName()}}</h4>
                <div class="secondary">
                    <div ng-show="diagnosis.firstDiagnosis" class="current">
                        <span class="time-stamp">
                            <span class="date">{{diagnosis.firstDiagnosis.diagnosisDateTime | date :'dd MMM yy'}}</span>
                            <span class="time">{{diagnosis.firstDiagnosis.diagnosisDateTime | date :'hh:mm a'}}</span>
                        </span>
                        <span class="provider" ng-repeat="provider in diagnosis.firstDiagnosis.providers">{{provider.name}}</span>
                    </div>
                    <div class="state">
                        <span ng-show="diagnosis.isPrimary()" class="order">Primary</span>
                        <span ng-hide="diagnosis.isPrimary()" class="order">Secondary</span>
                        <span class="certainty">{{diagnosis.certainty}}</span>
                        <!-- <span class="status">{{diagnosis.diagnosisStatus}}</span> -->
                    </div>
                </div>
            </div>
        </div>

        <div class="block-content" ng-show="editedDiagnosesFromPastEncounters.length > 0">
            <h4 class="section">Past</h4>
            <div class="diagnosis-row" ng-repeat="diagnosis in editedDiagnosesFromPastEncounters | primaryDiagnosisFirst">
                <h4 class="diagnosis-name" ng-class="{'ruled-out': diagnosis.diagnosisStatus}">{{diagnosis.getDisplayName()}}</h4>
                <div class="secondary">
                    <div ng-show="diagnosis.firstDiagnosis" class="current">
                        <span class="time-stamp">
                            <span class="date">{{diagnosis.firstDiagnosis.diagnosisDateTime | date :'dd MMM yy'}}</span>
                            <span class="time">{{diagnosis.firstDiagnosis.diagnosisDateTime | date :'hh:mm a'}}</span>
                        </span>
                        <span class="provider" ng-repeat="provider in diagnosis.firstDiagnosis.providers">{{provider.name}}</span>
                    </div>
                    <div class="state">
                        <span ng-show="diagnosis.isPrimary()" class="order">Primary</span>
                        <span ng-hide="diagnosis.isPrimary()" class="order">Secondary</span>
                        <span class="certainty">{{diagnosis.certainty}}</span>
                        <!-- <span class="status">{{diagnosis.diagnosisStatus}}</span> -->
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="block observation">
        <h2>Observations</h2>
        <section class="block">
            <div ng-repeat="observationGroup in groupedObservations">
                <table>
                    <tr>
                        <td colspan="3" class="headerRow">
                            <span class="obs-value">{{observationGroup.conceptSetName}}</span>
                        </td>
                    </tr>

                    <tr toggle="observation.showComment" ng-repeat-start="observation in observationGroup.groupMembers"
                        ng-class="{true: 'is-abnormal'}[observation.abnormal.value]">
                        <td class="name">
                            <span class="obs-value">{{observation.concept.name}}</span>
                        </td>
                        <td class="value" data-ng-switch="observation.concept.conceptClass">
                            <img data-ng-switch-when="Image" ng-src="{{observation.value|thumbnail}}" width="100">
                            <span data-ng-switch-default class="obs-value"><pre class="chief-notes">{{observation | observationValue}} {{observation.concept.units}}</pre></span>

                            <div class="footer-note fr">
                                <span class="time-stamp">
                                    <span class="time">{{observation.observationDateTime | date :'hh:mm a'}}</span>
                                </span>
                                <span class="provider" bindonce="observation" bo-text="observation.provider"></span>
                            </div>
                        </td>
                        <td>
                            <button class="toggle fr" ng-if="observation.comment">
                                <i class="icon-plus-sign" ng-hide="observation.showComment"></i>
                                <i class="icon-minus-sign" ng-show="observation.showComment"></i>
                            </button>
                        </td>
                    </tr>
                    <tr ng-repeat-end ng-if="observation.comment" ng-show="observation.showComment">
                        <td class="notes inline-notes" colspan="3">{{observation.comment}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </section>
    <section class="block investigation" style="display:none;"> <!--Hiding the section for release 4-->
        <h2>Investigation</h2>
        <ul class="block-content">
            <li ng-repeat="investigation in consultation.investigations" ng-class="{panel: investigation.concept.set, voided: investigation.voided}">
                <span>{{investigation.concept.name}}</span>
                <span ng-show="investigation.concept.set" class="panel">P</span>
            </li>
        </ul>
        <div ng-show="consultation.labOrderNote.value" class="notes">
          <h5 class="title">Notes:</h5>
          <p class="content">{{consultation.labOrderNote.value}}</p>
        </div>
        <ng-include src="'views/labResults.html'" ng-init="labResults=consultation.labResults"/>
    </section>
    <section class="block treatment" style="display:none;"> <!--Hiding the section for release 4-->
        <h2>Treatment</h2>
         <div  class="block-content" ng-include src="'views/treatmentDrugs.html'"></div>
    </section>
    <section class="block disposition">
        <h2>Disposition</h2>
            <ul ng-if="disposition.code && !disposition.voided">
                <li>
                    <span>{{disposition.conceptName}}</span><span class="disposition-time">{{disposition.dispositionDateTime | date :'dd-MM-yyyy hh:mm' }}</span>
                    <div class="notes inline-notes" ng-if="disposition.additionalObs[0].value">
                        {{disposition.additionalObs[0].value}}
                    </div>
                </li>
            </ul>
    </section>
    <section class="block consultationNote">
        <h2>Consultation Notes</h2>
        <textarea ng-model="consultation.consultationNote.value" ng-change="onNoteChanged()" placeholder="Notes: " rows="6"></textarea>
    </section>
</article>

