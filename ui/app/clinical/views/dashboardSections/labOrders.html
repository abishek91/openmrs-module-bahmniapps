<div ng-controller="PatientDashboardLabOrdersController" class="dashboard-laborders-section">

    <h2 ng-dialog="views/dashboardSections/labSummary.html"
               ng-dialog-class="ngdialog-theme-flat ngdialog-theme-custom"
               ng-dialog-controller="PatientDashboardLabSummaryController">{{section.description}}<button class="fr toggle btn-expand"><i class="icon-external-link"></i></button></h2>
    <section class="block" ng-class="{'more': patientSummary.show}">
        <p class="placeholder-text" ng-if="!hasLabOrders()">{{ patientSummary.message }}</p>

        <div ng-if="hasLabOrders()">
            <table ng-repeat="labOrdersForVisit in labOrdersForLatestVisits">
                <thead>
                <tr>
                    <th colspan="2">{{labOrdersForVisit.displayName}}</th>
                </tr>
                <tr ng-if="!labOrdersForVisit.labOrders || labOrdersForVisit.labOrders.length === 0">
                    <td colspan="2">No lab orders for this visit</td>
                </tr>
                </thead>
                <tbody ng-repeat="labOrder in labOrdersForVisit.labOrders">
                <tr ng-if="labOrder.isPanel()" ng-class="testResultClass(labOrder)">
                    <td colspan="2">
                        <strong>{{labOrder.concept.name}}</strong>
                    </td>
                </tr>
                <tr ng-if="labOrder.isPanel()" ng-repeat="test in labOrder.orderable.tests">
                    <td class="testUnderPanel">
                        <span >{{test.concept.name}}</span>
                        <span class="range" ng-if="hasResult(test) && hasRange(test.results[0])">
                            <span>
                            {{' (' + test.results[0].minNormal  + ' - ' + test.results[0].maxNormal  + ') '}}
                            </span>
                            <span class="units">{{test.results[0].units }}</span>
                        </span>
                    </td>
                    <td class="value">
                        <span ng-if="hasResult(test)">
                            <span ng-class="{'referred-out': isReferredOut(test.results)}">
                                <span class="referred">
                                    R
                                </span>
                            </span>
                            <span class="line-value"
                                  ng-class="{'is-abnormal': test.results[0].isAbnormal}">
                            {{test.results[0].value}}

                            </span>
                            <span class="fr date">{{ labOrder.orderDate | date :'dd MMM yy'}}</span>
                        </span>
                    </td>
                </tr>

                <tr ng-if="!labOrder.isPanel()">
                    <td>
                        <span>{{labOrder.concept.name}}</span>
                            <span class="range"
                                  ng-if="hasResult(labOrder.orderable) && hasRange(labOrder.orderable.results[0])">
                                <span>
                                {{' (' + labOrder.orderable.results[0].minNormal  + ' - ' +
                                    labOrder.orderable.results[0].maxNormal
                                    + ') '}}
                                </span>
                                <span class="units">{{labOrder.orderable.results[0].units }}</span>
                            </span>
                    </td>
                    <td class="value">
                        <span ng-if="hasResult(labOrder.orderable)">
                            <span ng-class="{'referred-out': isReferredOut(labOrder.orderable.results)}">
                                <span class="referred">
                                    R
                                </span>
                            </span>
                            <span class="line-value" ng-class="{'is-abnormal': labOrder.orderable.results[0].isAbnormal}">
                                {{labOrder.orderable.results[0].value}}
                            </span>
                            <span class="fr date">{{ labOrder.orderDate | date :'dd MMM yy'}}</span>
                        </span>
                    </td>
                </tr>
                </tbody>
            </table>

            <button class="show-more" ng-if="patientSummary.data.length > 8" ng-click="toggle(patientSummary)">
                <span class="more-text">Show more</span><span class="less-text">Show less</span>
            </button>
        </div>

    </section>
</div>