<header class="template-header">
    <button class="ngdialog-close back-btn">Back</button>
    <h5>
        <i class="icon-user"></i>
        <span>{{patient.name}} {{'(' + patient.identifier + ')'}}</span>
    </h5>
    <h6>All Lab Results</h6>
</header>

<div ng-show="tabular">
    <div ng-hide="tabular.hasOrders()" class="messages">
        <p class="messages null-data-message">No Lab Orders for this patient.</p>
    </div>
    <div class="template-container" ng-show="tabular.hasOrders()">
        <section class="section-grid">
            <h2 ng-click="toggleInvestigationChart()" class="section-title row-click">
                <i class="icon-caret-right" ng-hide="showInvestigationChart"></i>
                <i class="icon-caret-down" ng-show="showInvestigationChart"></i>
                Investigation Chart
            </h2>

            <table class="ipd-investigation h-scroll" bindonce="tabular" ng-show="showInvestigationChart">
                <thead>
                <tr>
                    <th>&nbsp;</th>
                    <th class="normal" ng-repeat="testOrderLabel in tabular.getTestOrderLabels()">
                        <span bo-text="testOrderLabel.testName"></span>
                            <span ng-show="tabular.hasRange(testOrderLabel)" class="range">
                                <span bo-text="'(' + testOrderLabel.minNormal + ' - ' + testOrderLabel.maxNormal + ')'"></span> 
                                <span bo-text="testOrderLabel.testUnitOfMeasurement"></span>
                            </span>
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="dateLabel in tabular.getDateLabels()">
                    <td>{{dateLabel.date | date :'dd MMM yy'}}</td>
                    <td ng-repeat="testOrderLabel in tabular.getTestOrderLabels()"
                        ng-class="{'has-uploaded-file': tabular.hasUploadedFiles(dateLabel, testOrderLabel)}">
                            <span ng-init="results = tabular.getResult(dateLabel, testOrderLabel)">
                                <span bm-pop-over class="test-result" ng-repeat="res in results">
                                    <span ng-class="{'referred-out': res.referredOut}">
                                        <span class="referred">R</span>
                                    </span>
                                    <span ng-show="res.result" bm-pop-over-trigger
                                          ng-class="{'is-abnormal': res.abnormal, 'one-result': results.length==1}"
                                          class="ipd-test-results" bo-text="res.result">
                                    </span>
                                    <span ng-show="res.uploadedFileName">
                                        <a class="uploaded-file" href="{{getUploadedFileUrl(res.uploadedFileName)}}"
                                           onclick="event.stopPropagation()" target="_blank">
                                            <i class="icon-paper-clip"></i>
                                        </a>
                                    </span>
                                    <span class="tooltip" bm-pop-over-target>
                                        <i class="icon-caret-left"></i>
                                        <span ng-class="{'is-abnormal': res.abnormal}">{{res.result}}</span>
                                    </span>
                                </span>
                            </span>
                    </td>
                </tr>
                <tbody>
            </table>
        </section>

        <section class="section-grid">
            <h2 class="section-title">Lab Investigations (without Accession Notes)</h2>

            <table ng-repeat="labOrderResults in labAccessions" bindonce="labAccessions">
                <thead>
                <th colspan="3">
                    <span>Accession at </span>
                    <span bo-text="labOrderResults[0].accessionDateTime | date:'dd-MMM-yyyy HH:mm'"></span>
                </th>
                </thead>
                <tbody lab-order-line test="labOrderResult" ng-repeat="labOrderResult in labOrderResults">
                </tbody>
            </table>
        </section>
    </div>
</div>